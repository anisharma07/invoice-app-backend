# HTML to PDF API Documentation

This API provides comprehensive HTML to PDF conversion capabilities with multiple input methods and cloud storage integration.

## Base URL

```
http://localhost:8888/pdf
```

## Endpoints

### 1. Generate PDF from HTML

**POST** `/generate`

Convert HTML content to PDF and store it in the cloud.

#### Input Methods

##### Method 1: Direct HTML Content

```json
{
  "user_id": "string (required)",
  "html_content": "string (required)",
  "filename": "string (optional, default: 'generated_document.pdf')",
  "options": {
    "page-size": "A4",
    "margin-top": "1in",
    "margin-bottom": "1in",
    "margin-left": "0.75in",
    "margin-right": "0.75in"
  }
}
```

##### Method 2: From URL

```json
{
  "user_id": "string (required)",
  "url": "string (required, valid HTTP/HTTPS URL)",
  "filename": "string (optional)",
  "options": {
    "page-size": "A4"
  }
}
```

##### Method 3: HTML File Upload

```
Content-Type: multipart/form-data

user_id: string (required)
file: HTML file (.html or .htm)
```

#### PDF Options

You can customize PDF generation with these options:

- `page-size`: A4, A3, A5, Letter, Legal, Tabloid
- `orientation`: Portrait, Landscape
- `margin-top`, `margin-bottom`, `margin-left`, `margin-right`: CSS units (px, in, cm, mm)
- `encoding`: UTF-8, ISO-8859-1, etc.
- `disable-smart-shrinking`: true/false
- `print-media-type`: true/false

#### Response

```json
{
  "success": true,
  "file_id": 123,
  "filename": "document.pdf",
  "s3_key": "uuid-filename.pdf",
  "source_type": "direct|url|file",
  "size": 12345,
  "message": "PDF generated and uploaded successfully"
}
```

#### Error Response

```json
{
  "error": "Error description"
}
```

### 2. Preview PDF (No Storage)

**POST** `/preview`

Generate and return PDF directly without storing it.

#### Request

```json
{
  "html_content": "string (required)",
  "options": {
    "page-size": "A4",
    "margin-top": "1in"
  }
}
```

#### Response

- **Content-Type**: `application/pdf`
- **Body**: PDF binary data

### 3. Download PDF

**GET** `/download/{file_id}`

Download a previously generated PDF file.

#### Response

- **Content-Type**: `application/pdf`
- **Content-Disposition**: `attachment; filename="original_filename.pdf"`
- **Body**: PDF binary data

### 4. List User PDFs

**GET** `/list/{user_id}`

Get a list of all PDFs generated by a user.

#### Response

```json
{
  "success": true,
  "count": 3,
  "pdfs": [
    {
      "id": 123,
      "filename": "document.pdf",
      "created_at": "2025-07-10T10:30:00",
      "source_type": "direct",
      "original_url": null
    },
    {
      "id": 124,
      "filename": "webpage.pdf",
      "created_at": "2025-07-10T11:00:00",
      "source_type": "url",
      "original_url": "https://example.com"
    }
  ]
}
```

### 5. Delete PDF

**DELETE** `/delete/{file_id}`

Delete a PDF file from both storage and database.

#### Response

```json
{
  "success": true,
  "message": "PDF deleted successfully"
}
```

## Usage Examples

### Example 1: Convert HTML String to PDF

```bash
curl -X POST "http://localhost:8888/pdf/generate" \
  -H "Content-Type: application/json" \
  -d '{
    "user_id": "user123",
    "html_content": "<!DOCTYPE html><html><body><h1>Hello World</h1></body></html>",
    "filename": "hello.pdf",
    "options": {
      "page-size": "A4",
      "margin-top": "1in"
    }
  }'
```

### Example 2: Convert Web Page to PDF

```bash
curl -X POST "http://localhost:8888/pdf/generate" \
  -H "Content-Type: application/json" \
  -d '{
    "user_id": "user123",
    "url": "https://example.com",
    "filename": "example.pdf"
  }'
```

### Example 3: Upload HTML File and Convert

```bash
curl -X POST "http://localhost:8888/pdf/generate" \
  -F "user_id=user123" \
  -F "file=@document.html"
```

### Example 4: Preview PDF

```bash
curl -X POST "http://localhost:8888/pdf/preview" \
  -H "Content-Type: application/json" \
  -d '{
    "html_content": "<html><body><h1>Preview</h1></body></html>"
  }' \
  --output preview.pdf
```

### Example 5: Download PDF

```bash
curl -X GET "http://localhost:8888/pdf/download/123" \
  --output downloaded.pdf
```

### Example 6: List User PDFs

```bash
curl -X GET "http://localhost:8888/pdf/list/user123"
```

### Example 7: Delete PDF

```bash
curl -X DELETE "http://localhost:8888/pdf/delete/123"
```

## JavaScript/Frontend Integration

### Using Fetch API

```javascript
// Generate PDF from HTML
async function generatePDF(htmlContent, userId) {
  const response = await fetch('/pdf/generate', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({
      user_id: userId,
      html_content: htmlContent,
      filename: 'document.pdf',
      options: {
        'page-size': 'A4',
        'margin-top': '1in'
      }
    })
  });

  return await response.json();
}

// Preview PDF
async function previewPDF(htmlContent) {
  const response = await fetch('/pdf/preview', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({
      html_content: htmlContent
    })
  });

  if (response.ok) {
    const blob = await response.blob();
    const url = URL.createObjectURL(blob);
    window.open(url, '_blank');
  }
}

// Upload HTML file
async function uploadHTMLFile(file, userId) {
  const formData = new FormData();
  formData.append('file', file);
  formData.append('user_id', userId);

  const response = await fetch('/pdf/generate', {
    method: 'POST',
    body: formData
  });

  return await response.json();
}
```

## Error Codes

- **400 Bad Request**: Missing required parameters or invalid input
- **404 Not Found**: PDF file not found
- **500 Internal Server Error**: Server error during PDF generation or storage

## Dependencies

The API requires the following Python packages:

- `flask`
- `pdfkit`
- `beautifulsoup4`
- `requests`
- `boto3` (for AWS S3)
- `psycopg2-binary` (for PostgreSQL)

## System Requirements

- **wkhtmltopdf**: This API uses `pdfkit`, which requires `wkhtmltopdf` to be installed on the system.

### Installing wkhtmltopdf

#### Ubuntu/Debian

```bash
sudo apt-get update
sudo apt-get install wkhtmltopdf
```

#### CentOS/RHEL

```bash
sudo yum install wkhtmltopdf
```

#### macOS

```bash
brew install wkhtmltopdf
```

#### Windows

Download from: https://wkhtmltopdf.org/downloads.html

## Security Considerations

1. **URL Validation**: The API validates URLs to prevent SSRF attacks
2. **File Type Validation**: Only HTML files are accepted for upload
3. **Content Sanitization**: HTML content is parsed and cleaned using BeautifulSoup
4. **User Isolation**: Files are stored with user-specific prefixes in S3

## Performance Notes

- PDF generation is CPU-intensive; consider implementing rate limiting for production use
- Large HTML documents or complex CSS may take longer to process
- Network timeouts apply to URL fetching (30 seconds default)

## Storage Structure

Files are stored in S3 with the following structure:

```
bucket/
├── user_123/
│   ├── pdfs/
│   │   ├── uuid1-document.pdf
│   │   └── uuid2-webpage.pdf
│   └── uploads/
│       └── other-files...
└── user_456/
    └── pdfs/
        └── uuid3-report.pdf
```
